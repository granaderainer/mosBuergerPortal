<div class="modal fade" id="showPollModal" tabindex="-1" role="dialog" aria-labelledby="showPollModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Umfrage anzeigen</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="pollModalDiv" style="display:none;">
                    <div id="pollModalTitle"></div>
                    <hr>
                    <div id="pollModalText"></div>
                    <hr>
                    <div id="pollModalEnd"></div>
                    <hr>
                    <input type="hidden" name="pollModalId" id="pollModalId" />
                    <div id="pollModalVotes"></div>
                    <div id="pollChartModal" style="height: 400px;"></div>
                </div>
                <div id="pollModalLoad">
                    <div class="text-center">
                        <span class="fa fa-spinner fa-spin fa-3x"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
                <button id="submitModal" type="submit" class="btn btn-primary" data-dismiss="modal" onclick="changepollStatus()">Speichern</button>

            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $('#showPollModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var pollId = button.data('pollid')
        $("#pollChartModal").empty();
        $("#pollModalDiv").hide();
        $("#pollModalLoad").show();
        getPoll(pollId);
    });
    function getPoll(pollId) {
        $.get("/Administration/GetPollJson", { pollId: pollId }, function (data) {
            console.log(data);
            var dateArr = data.end.split("T")[0].split("-");
            var dateString = dateArr[2] + "." + dateArr[1] + "." + dateArr[0];
            $("#pollModalDiv").show();
            $("#pollModalLoad").hide();
            $("#pollModalId").val(pollId);
            $("#pollModalTitle").html("<h4>" + (data.title) + "</h4>");
            $("#pollModalText").html(data.text);
            $("#pollModalEnd").html("Läuft am " + dateString + " ab.");
            $("#pollModalVotes").html("Es haben " + (data.votes) + " Einwohner abgestimmt!");
            var id = $("#pollChartModal").attr('id');
            createChart(id, pollId);
            setTimeout(function () {
                $("#pollModalDiv").show();
                $("#pollModalLoad").hide();
            }, 3000)

        });
    }

</script>

@*
    @{
        ViewData["Title"] = "PollAdministrationView";
        Layout = "~/Views/Shared/_AdministrationLayout.cshtml";
        var pollId = Model.Id;
    }

    <h2>PollAdministrationView</h2>

    <div class="col-md-3">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="text-center">@Html.DisplayFor(model => model.Title)</h4>
            </div>
            <div class="panel-body">
                <dl class="dl-horizontal">
                    <dt>
                        @Html.DisplayNameFor(model => model.Text)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.Text)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.End)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.End)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.Category)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.Category.Id)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.User)
                    </dt>
                    <dd>
                        @Html.DisplayFor(model => model.User.Password)
                    </dd>
                </dl>
                <div id="pollChart" style="height: 250px;"></div>
                <div class="text-right">
                    <a class="btn btn-success" asp-area="" asp-controller="Home" asp-action="ShowConcerns">Umfrage anzeigen</a>
                </div>
            </div>
        </div>
    </div>
    <div>
        <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a> |
        <a asp-action="Index">Back to List</a>
    </div>

    <script type="text/javascript">
        $(document).ready(function()
        {
            $.get("/Administration/GetPollAnswers", { pollId: @pollId  }, function (data) {
                Morris.Donut({
                    element: 'pollChart',
                    data: data
                });
                console.log(data);
            });


         });
    </script>
*@